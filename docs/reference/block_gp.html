<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>(generalized) Block forecasting using Gaussian Processes — block_gp • rEDM</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="(generalized) Block forecasting using Gaussian Processes — block_gp" />

<meta property="og:description" content="block_gp uses multiple time series given as input to generate an 
attractor reconstruction, and then applies Gaussian process regression to 
approximate the dynamics and make forecasts. This method is the 
generalized version of tde_gp, which constructs the block from 
lags of a time series to pass into this function." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rEDM</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.7.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/rEDM-coprediction.html">co-prediction: using rEDM to quantify dynamic similarity</a>
    </li>
    <li>
      <a href="../articles/rEDM-time-delay-ccm.html">Using rEDM to quantify time delays in causation</a>
    </li>
    <li>
      <a href="../articles/rEDM-tutorial.html">rEDM: An R package for Empirical Dynamic Modeling and Convergent Cross Mapping</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>(generalized) Block forecasting using Gaussian Processes</h1>
    
    <div class="hidden name"><code>block_gp.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p><code>block_gp</code> uses multiple time series given as input to generate an 
attractor reconstruction, and then applies Gaussian process regression to 
approximate the dynamics and make forecasts. This method is the 
generalized version of <code><a href='tde_gp.html'>tde_gp</a></code>, which constructs the block from 
lags of a time series to pass into this function.</p>
    
    </div>

    <pre class="usage"><span class='fu'>block_gp</span>(<span class='no'>block</span>, <span class='kw'>lib</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>1</span>, <span class='fu'>NROW</span>(<span class='no'>block</span>)), <span class='kw'>pred</span> <span class='kw'>=</span> <span class='no'>lib</span>, <span class='kw'>tp</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>phi</span> <span class='kw'>=</span> <span class='fl'>0</span>,
  <span class='kw'>v_e</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>eta</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>fit_params</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>columns</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>target_column</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>stats_only</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>save_covariance_matrix</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>first_column_time</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>silent</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>block</th>
      <td><p>either a vector to be used as the time series, or a 
data.frame or matrix where each column is a time series</p></td>
    </tr>
    <tr>
      <th>lib</th>
      <td><p>a 2-column matrix (or 2-element vector) where each row specifies 
the first and last *rows* of the time series to use for attractor 
reconstruction</p></td>
    </tr>
    <tr>
      <th>pred</th>
      <td><p>(same format as lib), but specifying the sections of the time 
series to forecast.</p></td>
    </tr>
    <tr>
      <th>tp</th>
      <td><p>the prediction horizon (how far ahead to forecast)</p></td>
    </tr>
    <tr>
      <th>phi</th>
      <td><p>length-scale parameter. see 'Details'</p></td>
    </tr>
    <tr>
      <th>v_e</th>
      <td><p>noise-variance parameter. see 'Details'</p></td>
    </tr>
    <tr>
      <th>eta</th>
      <td><p>signal-variance parameter. see 'Details'</p></td>
    </tr>
    <tr>
      <th>fit_params</th>
      <td><p>specify whether to use MLE to estimate params over the lib</p></td>
    </tr>
    <tr>
      <th>columns</th>
      <td><p>either a vector with the columns to use (indices or names), 
or a list of such columns</p></td>
    </tr>
    <tr>
      <th>target_column</th>
      <td><p>the index (or name) of the column to forecast</p></td>
    </tr>
    <tr>
      <th>stats_only</th>
      <td><p>specify whether to output just the forecast statistics or 
the raw predictions for each run</p></td>
    </tr>
    <tr>
      <th>save_covariance_matrix</th>
      <td><p>specifies whether to include the full 
covariance matrix with the output (and forces the full output as if 
stats_only were set to FALSE)</p></td>
    </tr>
    <tr>
      <th>first_column_time</th>
      <td><p>indicates whether the first column of the given 
block is a time column (and therefore excluded when indexing)</p></td>
    </tr>
    <tr>
      <th>silent</th>
      <td><p>prevents warning messages from being printed to the R console</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>other parameters. see 'Details'</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>If stats_only, then a data.frame with components for the parameters 
  and forecast statistics:</p><table class='table'>
<tr><td><code>embedding</code></td><td>embedding</td></tr>
<tr><td><code>tp</code></td><td>prediction horizon</td></tr>
<tr><td><code>phi</code></td><td>length-scale parameter</td></tr>
<tr><td><code>v_e</code></td><td>noise-variance parameter</td></tr>
<tr><td><code>eta</code></td><td>signal-variance parameter</td></tr>
<tr><td><code>fit_params</code></td><td>whether params were fitted or not</td></tr>
<tr><td><code>num_pred</code></td><td>number of predictions</td></tr>
<tr><td><code>rho</code></td><td>correlation coefficient between observations and 
    predictions</td></tr>
<tr><td><code>mae</code></td><td>mean absolute error</td></tr>
<tr><td><code>rmse</code></td><td>root mean square error</td></tr>
<tr><td><code>perc</code></td><td>percent correct sign</td></tr>
<tr><td><code>p_val</code></td><td>p-value that rho is significantly greater than 0 using 
    Fisher's z-transformation</td></tr>
<tr><td><code>model_output</code></td><td>data.frame with columns for the time index, 
    observations, mean-value for predictions, and independent variance for 
    predictions (if <code>stats_only == FALSE</code> or 
    <code>save_covariance_matrix == TRUE</code>)</td></tr>
<tr><td><code>covariance_matrix</code></td><td>the full covariance matrix for predictions 
    (if <code>save_covariance_matrix == TRUE</code>)</td></tr>
<tr><td></td><td><code>embedding</code></td></tr>
</table>


    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The default parameters are set so that passing a vector as the only 
argument will use that vector to predict itself one time step ahead. If a 
matrix or data.frame is given as the only argument, the first column will be 
predicted (one time step ahead), using the remaining columns as the 
embedding. Rownames will be converted to numeric if possible to be used as 
the time index, otherwise 1:NROW will be used instead. The default lib and 
pred are to perform maximum likelihood estimation of the phi, v_e, and eta 
parameters over the whole time series, and return just the forecast 
statistics.</p>
<p>If phi, v_e, and eta parameters are given, all combinations of their values 
will be tried. If fit_params is also set to TRUE, these values will be the 
initial values for subsequent optimization of likelihood.</p>
<p>The basic model is:
  $$y = f(x) + \textnormal{noise}
  $$
in which the function f(x) is modeled using a Gaussian process prior:
  $$f \sim \textnormal{GP}(0, C)
$$
with mean = 0,
and covariance function, C, which is given by the squared-exponential kernel:
  $$C_{ij} = eta * \exp(-phi^2 * ||x_i - x_j||^2)
$$</p>
<p>y is a realization from process f with normally-distributed i.i.d. process 
noise,
  $$noise \sim \mathcal(N)(0, v_e)
  $$
such that the covariance of observations y_i and y_j is
  $$K_{ij} = C_{ij} + v_e * \delta_{ij}$$
where \(\delta_{ij}\) is the kronecker delta (i.e. it is 1 if \(i = j\) 
and 0 otherwise)</p>
<p>From the model definition, the variance in y, after marginalizing over f, is 
given by eta + v_e. Thus to simplify specification of priors for the 
hyperparameters eta and v_e, the outputs y are normalized to zero mean and 
unit variance prior to fitting. This allows us to set (0, 1) bounds on 
eta and v_e which facilitates parameter estimation.  We set Beta(2, 2) 
priors for both eta and v_e to partition prior uncertainty equally across 
structural and process uncertainty.</p>
<p>For a scalar input, the length-scale parameter phi controls the expected 
number of zero crossings on the unit interval as 
  $$E(crossings) = \frac{\sqrt(2)}{\pi} \phi \approx 0.45 \phi
  $$</p>
<p>Thus to facilitate interpretation and prior specification, the distances in 
C are scaled by the max distance so that a model with \(\phi = 2\) would 
have roughly one zero crossing over the range of the data.  We assign phi a 
half-Normal prior with variance \(\pi / 2\) so that the prior mean phi is 
1, which tends to avoid overfitting. 
To fit the GP we estimate eta, v_e, and phi by maximizing the posterior after
marginalizing over f(x). This is given by the multivariate normal likelihood 
  $$logL = -1/2 \log{|K_d|}^{-1/2} y_d^T [K_d]^{-1} y_d
$$
where \(K_d\) is the matrix obtained by evaluating the covariance function 
at all pairs of inputs and \(y_d\) is the column vector of outputs. 
Predictions for new values of x are obtained by setting eta, v_e, and phi to 
the Maximum a Posteriori (MAP) estimates and using the GP conditional on the 
observed data.  Specifically, given \(x_d\) and \(y_d\), 
the mean and variance for y evaluated at a new value of x are
  $$E(y) = C(x, x_d) [K_d]^{-1} y_d
  $$
  $$V(y) = eta + v_e - C(x, x_d)[K_d]^{-1} C(x_d, x)
  $$
where the vector \(C(x, x_d)\) is obtained by evaluating C at x and each 
of the observed inputs while holding eta, phi, and v_e at the MAP estimates.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'>data</span>(<span class='st'>"two_species_model"</span>)
<span class='no'>block</span> <span class='kw'>&lt;-</span> <span class='no'>two_species_model</span>[<span class='fl'>1</span>:<span class='fl'>200</span>,]
<span class='fu'>block_gp</span>(<span class='no'>block</span>, <span class='kw'>columns</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"x"</span>, <span class='st'>"y"</span>), <span class='kw'>first_column_time</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt;   embedding tp       phi       v_e      eta fit_params num_pred       rho
#&gt; 1      1, 2  1 0.5302931 -170.4109 6.904724       TRUE      199 0.9999775
#&gt;           mae        rmse perc p_val
#&gt; 1 0.001004117 0.001284706    1     0</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Hao Ye, Adam Clark, Ethan Deyle, Steve Munch.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

